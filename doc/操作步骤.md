# 操作步骤（用户体系基础版）

本文记录：本次实现落地的内容概览、SQL 脚本位置、接口入口，以及本地验证步骤。

## 0. 项目模块结构（已整理）

- `gm-api`：仅放 Controller（对外接口）+ Spring Boot 启动入口
- `gm-user`：用户体系领域模块（`entity/mapper/service/dto`）
- `gm-file`：文件上传/管理领域模块（`entity/mapper/service/dto`）
- `gm-ow`：OW（角斗领域/军械库模拟器）领域模块（`entity/mapper/service/dto`）
- `gm-common`：通用能力（统一响应、全局异常、分页模型、请求工具等）
- `gm-config`：项目配置（MyBatis-Plus、Sa-Token、密码加密等 Spring 配置类）

## 1. 技术选型（已确认）

- MySQL 8
- MyBatis-Plus
- Sa-Token（默认内存实现，不使用 Redis）
- 数据库变更：手工执行 `sql/` 脚本（不使用 Flyway/Liquibase）

技术栈明细：`doc/user-system-tech-stack.md`

## 2. 功能清单

功能清单与完成状态：`doc/user-system-feature-list.md`

## 3. SQL 脚本（手工执行）

- 说明文档：`sql/README.md`
- 建表脚本：`sql/00_schema/V202601261055__create_user_system_tables.sql`
- 初始化数据：`sql/10_seed/V202601261057__seed_user_system_admin.sql`
- 权限补丁（前台用户管理相关）：`sql/10_seed/V202601271830__add_admin_front_account_permissions.sql`
- 前台 Account 建表脚本：`sql/00_schema/V202601271700__create_account_tables.sql`
- 前台 Account 初始化数据：`sql/10_seed/V202601271701__seed_account_default.sql`
- 文件管理建表脚本：`sql/00_schema/V202601271955__create_file_tables.sql`
- 权限补丁（文件上传/管理相关）：`sql/10_seed/V202601271956__add_admin_file_permissions.sql`
- OW（角斗领域/军械库模拟器）建表脚本：`sql/00_schema/V202601271900__create_ow_hero_item_tables.sql`
- OW 初始化数据（基础配置/属性定义）：`sql/10_seed/V202601271940__seed_ow_base_info.sql`
- OW 初始化数据（默认英雄）：`sql/10_seed/V202601271948__seed_ow_default_hero.sql`
- OW 初始化数据（军械库物品）：`sql/10_seed/V202601271945__seed_ow_store_items.sql`
- 权限补丁（OW 配置相关）：`sql/10_seed/V202601271952__add_admin_ow_permissions.sql`

默认管理员（固定默认密码）：

- username：`admin`
- password：`z8ZFGBTwrfdv`

默认前台账号（固定默认密码，用于本地验证）：

- username：`user1`
- password：`User@123456`

## 4. 服务入口与接口

- 启动类：`gm-api/src/main/java/com/rcszh/gm/GmAdminApplication.java`
- 本地配置示例：`gm-api/src/main/resources/application.yml`

接口（路径前缀 `/api`）：

- 登录：`POST /api/auth/login`
- 前台账号登录：`POST /api/account/login`
- 用户：`/api/users`（需要登录 + 权限）
- 前台用户管理：`/api/accounts`（需要登录 + 权限）
- 角色：`/api/roles`（需要登录 + 权限）
- 权限点：`/api/permissions`（需要登录 + 权限）
- 审计：`/api/audits`（需要登录 + 权限）

前台账号接口：

- 当前账号：`GET /api/account/me`
- 更新基本信息：`PUT /api/account/me`
- 退出登录：`POST /api/account/logout`

## 5. 本地验证步骤

1) 创建数据库（示例库名：`gm_admin`，与 `application.yml` 一致）
2) 按顺序执行 SQL：
   - 先执行 `sql/00_schema/` 目录下脚本（按文件名排序）
   - 再执行 `sql/10_seed/` 目录下脚本（按文件名排序）
3) 启动应用（模块 `gm-api`）
4) 调用登录接口获取 token：
   - 使用 `admin / Admin@123456` 调 `POST /api/auth/login`
   - 返回中获取 `token`
5) 携带 token 访问需要登录的接口：
   - 按 Sa-Token 的 `token-name`（默认示例为 `satoken`）放到请求 Header 或 Cookie 中
   - 访问如：`GET /api/users`、`GET /api/roles` 等接口验证权限与数据返回

### 5.1 OW（角斗领域/军械库模拟器）本地验证（可选）

1) 确认已执行 OW 的建表与 seed 脚本（见第 3 节）
2) 前台页面访问：`/ow`
   - 首屏应先展示“选择英雄”
   - 选择英雄后加载该英雄可用装备（全局装备 + 该英雄专属装备）
3) 管理后台配置：
   - 先执行 `sql/10_seed/V202601271952__add_admin_ow_permissions.sql` 后重新登录后台（否则菜单无权限不展示）
   - 后台页面：`/admin/ow/heroes`、`/admin/ow/items`

### 5.2 文件上传/管理本地验证（可选）

1) 执行：
   - `sql/00_schema/V202601271955__create_file_tables.sql`
   - `sql/10_seed/V202601271956__add_admin_file_permissions.sql`
2) 重新登录后台
3) 后台页面：`/admin/files` 上传图片（biz 例如 `ow/item`）
4) 在 `/admin/ow/items` 编辑装备，点击“上传图片”，应自动写入图片 URL 并可预览

## 6. 备注

- SQL 为手工执行模式：后续任何表结构/数据修订，请新增版本化脚本，不要修改已执行过的历史脚本。
- 重置密码改为“管理员输入新密码”模式：接口不再返回临时密码。
