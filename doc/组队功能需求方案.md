# OW 网站「组队 / 邀请入队」功能需求方案（PRD + 技术落地草案）

> 面向当前系统（MySQL 8 + MyBatis-Plus + Sa-Token；不使用 Redis），新增一个「仅 Overwatch(OW)」的“组队大厅 + 邀请链接分享 + 加入队伍”的网站功能。
>
> 文档日期：2026-02-05

## 0. 一句话目标

让用户在站内快速发起/分享一个“组队邀请”，其他人通过链接或组队大厅发现并加入；整个流程页面精美、信息密度高、操作低摩擦、可控风控。

---

## 1. 背景与价值

### 1.1 背景

- 站内已有前台账号体系（Account）与社区内容能力（如 OW 社区/清单分享）。
- 需要一个“即时协作/社交”入口提升粘性：找人一起玩/一起活动/一起完成目标。

### 1.2 价值指标（可量化）

- 邀请发布量：`每日创建队伍数`
- 触达：`邀请页 UV`、`分享复制次数`、`二维码打开次数`
- 转化：`加入成功率`、`从邀请页到登录的转化率`
- 体验：`平均加入耗时`、`被拒率/撤销率`

---

## 2. 范围定义（MVP / 增强）

### 2.1 MVP 必做（建议第 1 期上线）

- 组队大厅：可浏览公开队伍/筛选/搜索
- 创建队伍：填写关键信息，生成邀请链接（可复制/二维码）
- 邀请页（可分享）：游客可看；登录后可加入/申请加入
- 入队机制：支持“直接加入（公开）/申请加入（需队长审批）”
- 队伍管理（队长侧）：同意/拒绝申请，踢人，关闭招募/解散
- 我的队伍：我创建/我加入的队伍列表（当前/历史）
- 风控最低线：频率限制、过期机制、举报入口（先落库）

### 2.2 增强（第 2 期及以后）

- 队伍内聊天/留言板（站内即可；也可先仅提供外部语音/群号字段）
- “开黑日程/开组时间”与提醒（站内通知）
- 推荐/置顶/精选（运营位）
- OW 专属模板增强（竞技/快速/自定义/军械库等模板更细；段位/位置/语音/跨平台等更强筛选）
- 信誉系统（爽约率、好评等）

### 2.3 明确不做（MVP）

- 实时在线匹配/实时房间状态（无 Redis + 高并发实时性要求较高）
- 复杂的反作弊（先以规则 + 日志为主）

---

## 3. 角色与权限

### 3.1 角色

- 游客：可浏览大厅、查看邀请页
- 前台账号（Account）：可创建队伍、申请/加入、退出、举报
- 队长（Leader）：创建者默认队长，拥有队伍管理权限
- 后台管理员（Admin，可选但建议预留）：可下架/解散违规队伍、封禁账号

### 3.2 权限原则

- “队伍管理权限”属于业务权限，不走 RBAC（类似社区创建清单需要 Account 登录态）。
- Admin 管理建议走后台 RBAC 权限点（后续加：`ow:lfg:team:list` / `ow:lfg:team:moderate`）。

---

## 4. 核心概念与状态机

### 4.1 核心概念

- 队伍（Team）：一次招募/组队信息的载体，有容量、有条件、有有效期
- 邀请（Invite）：队伍的对外入口，表现为可分享链接（携带 `inviteCode`）
- 成员（Member）：加入队伍的人（含队长）
- 申请（JoinRequest）：当队伍为“需审批”时产生

### 4.2 队伍状态（建议）

- `OPEN`：招募中（可加入/可申请）
- `CLOSED`：停止招募（不可加入；已在队伍的成员可正常退出）
- `EXPIRED`：过期（不可加入；用于“临时队伍”）
- `DISBANDED`：已解散（不可加入；仅保留历史记录）

### 4.3 成员状态（建议）

- `JOINED`：在队伍中
- `LEFT`：已退出
- `KICKED`：被踢出（用于风控与提示文案）

### 4.4 申请状态（建议）

- `PENDING`：待处理
- `APPROVED`：已同意（产生成员记录）
- `REJECTED`：已拒绝
- `CANCELED`：申请者撤销

### 4.5 OW 专属字典（建议）

> 仅 OW：把核心筛选项做成强枚举，前端标签/筛选与后端存储一致，避免自由文本导致不可筛选。

- `mode_code`：
  - `COMPETITIVE`（竞技）
  - `QUICK_PLAY`（快速）
  - `CUSTOM`（自定义）
  - `ARMORY`（军械库/角斗领域相关活动）
- `platform_code`：
  - `PC`
  - `CONSOLE`（可后续细分 `PS/XBOX/SWITCH`）
- `rank_*`（可选范围）：
  - `BRONZE` / `SILVER` / `GOLD` / `PLATINUM` / `DIAMOND` / `MASTER` / `GRANDMASTER` / `TOP500`
- `role`：
  - `TANK` / `DPS` / `SUPPORT`

---

## 5. 前端页面与路由（建议）

> 仅 OW：建议把路由挂到 `/ow/*` 下，与现有 OW 社区入口统一（参考现有 `/ow`、`/account/*`）。

### 5.1 组队大厅

- 路由：`/ow/lfg`
- 目标：快速发现队伍 + 高转化进入邀请页
- 主要模块：
  - 顶部：标题 + “创建队伍”按钮
  - 筛选区（可折叠）：模式（竞技/快速/自定义/军械库等）、平台（PC/主机）、段位范围、服务器区域、语言、语音要求、人数是否满、位置需求（坦/辅/输出）
  - 搜索：关键字（队伍标题/描述/标签）
  - 列表卡片：队伍信息摘要 + 当前人数/容量 + 剩余时间 + 加入门槛标签
  - 空状态：引导创建

### 5.2 创建队伍

- 路由：`/ow/lfg/new`（Account 登录必需）
- 表单建议字段（MVP）：
  - 队伍标题（必填，20-40 字最佳）
  - 场景模板（可选）：如“OW 快速/竞技/自定义/军械库”等（点击一键填充）
  - 模式（必填）：`QUICK_PLAY` / `COMPETITIVE` / `CUSTOM` / `ARMORY`（与你现有 OW 业务命名对齐即可）
  - 平台（必填）：`PC` / `CONSOLE`（可选再细分 `PS/XBOX/SWITCH`）
  - 跨平台（可选）：是否允许跨平台（如果平台细分到 PS/XBOX 等）
  - 队伍类型：`公开可直接加入` / `需队长同意`
  - 人数上限（必填，默认 5）
  - 位置需求（可选，多选）：`TANK` / `DPS` / `SUPPORT`
  - 段位范围（可选但推荐）：`最低段位` ~ `最高段位`（如 青铜-宗师；用于筛选与预期）
  - 主玩英雄（可选）：从英雄列表选择 1-3 个（用于偏好展示，不做强校验）
  - 服务器区域/语言（可选）
  - 语音要求（必填）：`必须`/`可选`/`不需要`
  - 有效期：`2h/6h/24h/自定义`（必填，默认 6h）
  - 备注/规则（可选，建议 140 字以内）
  - 联系方式（可选）：BattleTag/群号/语音房间（建议只在“加入后”可见，见隐私）
- 成功后：
  - 跳转队伍详情（管理视角）并弹出“分享面板”（复制链接/二维码）

### 5.3 邀请页（可分享落地页）

- 路由：`/ow/lfg/t/:inviteCode`
- 游客可见：队伍信息、当前成员、剩余名额、规则、CTA（登录后加入）
- 登录后可操作：
  - 公开队伍：`立即加入`
  - 需审批队伍：`申请加入`（可填一句话/自动带入默认文案）
- 分享组件（MVP）：
  - 复制链接
  - 二维码（同链接）
  - 分享文案一键复制（带队伍关键信息）
- SEO/分享卡片（建议）：
  - 设置 `title/description/og:image`（至少有通用封面图）

### 5.4 队伍详情（管理视角）

- 路由：`/ow/lfg/teams/:id`
- 进入条件：队长或成员可看（也可直接复用邀请页并根据身份展示更多模块）
- 队长可见模块：
  - 申请列表（待处理）
  - 成员管理（踢人、转让队长 *可后置*）
  - 编辑队伍信息、关闭招募、解散

### 5.5 我的队伍

- 路由（建议）：`/account/teams`（目前仅 OW，用“我的队伍”即可）
- 列表分组：我创建的 / 我加入的；状态标签（招募中/已满/已关闭/已过期）

---

## 6. 核心流程（用户故事）

### 6.1 发起组队并分享

1) Account 登录用户进入 `/ow/lfg/new` 填写信息并创建
2) 系统生成 `inviteCode`，默认 `OPEN`，队长自动成为第一个成员
3) 进入邀请页/详情页，点击“分享”，复制链接或展示二维码

验收点：
- 创建成功后 1 次点击即可复制链接
- 邀请页对游客展示完整信息但不暴露敏感字段（见隐私）

### 6.2 通过邀请链接加入（公开队伍）

1) 用户打开 `/ow/lfg/t/:inviteCode`
2) 未登录：点击加入 -> 跳转 `/account/login?redirect=...`，登录后回跳
3) 已登录：点击“立即加入” -> 后端校验容量/状态 -> 成功加入

边界：
- 队伍已满：按钮置灰，提示“已满，可收藏/关注（后置）”
- 已过期/已关闭：提示不可加入
- 已加入：按钮变为“已在队伍中 / 去队伍页”

### 6.3 通过邀请链接申请加入（需审批）

1) 用户打开邀请页，点击“申请加入”
2) 提交后状态显示“已申请，等待队长处理”（可撤销）
3) 队长在管理视角同意/拒绝
4) 申请者收到站内提示（MVP 可先做“我的队伍/申请列表”可见）

### 6.4 退出/踢出/解散

- 成员可退出：从“我的队伍”或队伍页点击退出
- 队长踢人：成员状态 `KICKED`，并写审计日志（业务日志）
- 队长解散：队伍状态 `DISBANDED`，邀请页展示“队伍已解散”

---

## 7. 功能需求明细（按模块）

### 7.1 组队大厅（列表 + 筛选）

- 列表展示字段（卡片建议）：
  - 标题、标签（模式/语音/语言/区域/角色需求）
  - 队长昵称（可选显示）、创建时间
  - 人数进度：`3/5` + 进度条
  - 剩余时间：`还剩 1h 20m`（到期后自动变为过期态）
- 列表排序（MVP）：
  - 默认：最新
  - 可选：即将过期优先 / 人数未满优先（后端可在 SQL 层实现）

### 7.2 创建队伍（表单体验）

- 表单 UX：
  - 分组排版：基础信息 / 招募条件 / 有效期 / 备注
  - 实时校验：标题、人数上限、有效期（错误提示使用 `role="alert"`）
  - “模板预设”：点一次填充（OW 竞技/快速等）以降低输入成本

### 7.3 邀请页（高转化落地）

- 信息结构（从上到下）：
  1) Hero 区：标题 + 关键标签 + 主 CTA（加入/申请）
  2) 队伍状态条：人数、剩余时间、是否语音、区域/语言
  3) 成员列表：头像（可用首字母圆形）、昵称、角色标签
  4) 规则/备注：可折叠
  5) 分享区：复制链接、二维码、分享文案
  6) 底部：举报入口（轻量）
- 微文案（示例）：
  - 公开队伍：`立即加入`
  - 需审批：`申请加入` / `等待队长通过`
  - 过期：`已过期，去大厅看看其他队伍`

### 7.4 队伍管理（队长）

- 申请列表：
  - 展示：申请者昵称、申请时间、留言（可选）
  - 操作：同意/拒绝（确认弹窗仅对“拒绝并拉黑 *后置*”等破坏性操作）
- 队伍编辑：
  - 可改：标题、备注、招募条件、有效期（延长/缩短）
  - 不可改（建议）：创建者、inviteCode（避免外链失效）
- 关闭招募：
  - 状态变为 `CLOSED`；邀请页 CTA 变灰并提示

### 7.5 我的队伍

- 当前队伍：展示进入按钮、状态、快捷分享（对队长）
- 历史队伍：只读，用于回访与复用（后置：一键“再开一队”）

### 7.6 隐私与展示分级（建议）

> 原则：邀请页对游客“信息足够做决定”，但不暴露可被滥用的个人联系方式。

- 游客可见（邀请页/大厅）：
  - 队伍标题、模式、平台、段位范围、语音要求、区域/语言、人数、剩余时间、规则/备注（可选）
  - 成员列表：展示 `displayName`（不展示账号 id、不展示联系方式）
- 仅成员可见（加入后/队伍详情）：
  - `contact_json`（BattleTag/语音房间/群号等）
  - 队长管理操作区（审批/踢人/关闭/解散）
- 可选增强：
  - 队长可选择“联系方式对游客隐藏/对申请者可见/对成员可见”（MVP 建议固定为“仅成员可见”）

### 7.7 风控与治理（MVP 最小可用）

- 创建频率限制（建议）：
  - 单账号：`每 10 分钟最多创建 1 个 OPEN 队伍`（可配置）
  - 单账号：`最多同时存在 3 个 OPEN 队伍`
- 反骚扰：
  - 被踢后 N 分钟内不可再次申请同队（可后置）
- 举报：
  - 邀请页提供“举报”入口，落库 `reason + snapshot`，供后台处理（第 2 期做管理 UI）

---

## 8. 视觉与交互规范（精美页面落地）

> 本节的配色/风格建议来自本地 `ui-ux-pro-max` 设计系统推荐（Retro-Futurism），并与现有站点暗色霓虹基调兼容。

### 8.1 建议风格（与现有暗色系一致）

- 风格关键词：Retro-Futurism / 霓虹发光 / 轻量玻璃拟态（克制使用）
- 主色建议：`#7C3AED`（紫）+ `#F43F5E`（玫红 CTA）
- 背景：`#0F0F23`（深靛蓝），卡片用更浅一档叠层

### 8.2 字体建议（两种方案）

- 方案 A（更统一）：沿用站点现有字体（如 `Outfit + Work Sans`）
- 方案 B（更“电竞/组队”氛围）：`Russo One`（标题）+ `Chakra Petch`（正文）

### 8.3 关键组件规范（建议）

- 队伍卡片：
  - hover：阴影 + 轻微上浮（不引发布局抖动）
  - 状态：`OPEN/CLOSED/EXPIRED/FULL` 使用“文字 + 图标”，不要仅靠颜色
- 进度条：
  - 显示人数 `3/5` + 颜色渐变（CTA 色系）
- 标签（Tag）：
  - 统一高度与圆角；不超过 2 行；溢出折叠为 `+N`
- CTA：
  - 公开队伍：主按钮 `立即加入`
  - 需审批：主按钮 `申请加入`；次按钮 `复制邀请`

### 8.4 可访问性与动效（最低要求）

- 对比度：正文至少 4.5:1
- 图标按钮必须有 `aria-label`
- 表单错误必须可被读屏器读取（`role="alert"` / `aria-live`）
- 支持 `prefers-reduced-motion`

---

## 9. 数据结构设计（MySQL，建议）

> 目标：支持 OW 组队邀请链接分享、加入/申请、容量控制、历史留存；不依赖 Redis。

### 9.1 队伍表：`ow_lfg_team`

字段建议（MVP）：

- `id` BIGINT PK
- `title` VARCHAR(128)
- `mode_code` VARCHAR(32)（必填；如 `COMPETITIVE/QUICK_PLAY/CUSTOM/ARMORY`）
- `platform_code` VARCHAR(16)（必填；`PC/CONSOLE`，可扩展）
- `allow_crossplay` TINYINT（可选；1/0）
- `capacity` INT（上限）
- `auto_approve` TINYINT（1=公开可直接加入；0=需审批）
- `region_code` VARCHAR(32)（可选）
- `language_code` VARCHAR(32)（可选）
- `voice_required` TINYINT（0/1/2：不需要/可选/必须）
- `rank_min` VARCHAR(16)（可选；如 `BRONZE`）
- `rank_max` VARCHAR(16)（可选；如 `MASTER`）
- `need_roles_json` JSON（可选；如 `["TANK","SUPPORT"]`）
- `preferred_hero_codes_json` JSON（可选；英雄 code 数组，最多 3）
- `tags_json` JSON（可选，字符串数组）
- `note` VARCHAR(512)（可选）
- `contact_json` JSON（可选；如 battleTag/语音房间；建议“仅成员可见”）
- `invite_code` VARCHAR(32) UNIQUE（用于分享链接）
- `status` VARCHAR(16)（`OPEN/CLOSED/EXPIRED/DISBANDED`）
- `expires_at` DATETIME（到期时间）
- `created_by_account_id` BIGINT
- `created_by_name` VARCHAR(64)（快照展示）
- `created_at` / `updated_at`
- `version` INT（乐观锁，防并发超卖）

索引建议：

- `UNIQUE (invite_code)`
- `INDEX (status, expires_at)`
- `INDEX (created_by_account_id, created_at)`

### 9.2 成员表：`ow_lfg_team_member`

- `id` BIGINT PK
- `team_id` BIGINT
- `account_id` BIGINT
- `display_name` VARCHAR(64)（快照）
- `role_tags_json` JSON（可选：`["TANK"]` 等）
- `status` VARCHAR(16)（`JOINED/LEFT/KICKED`）
- `joined_at` DATETIME
- `left_at` DATETIME（可选）

约束与索引：

- `UNIQUE (team_id, account_id)`（避免重复加入）
- `INDEX (account_id, joined_at)`

### 9.3 申请表：`ow_lfg_team_join_request`（仅当需审批）

- `id` BIGINT PK
- `team_id` BIGINT
- `account_id` BIGINT
- `display_name` VARCHAR(64)（快照）
- `message` VARCHAR(140)（可选）
- `status` VARCHAR(16)（`PENDING/APPROVED/REJECTED/CANCELED`）
- `created_at` / `updated_at`

索引建议：

- `UNIQUE (team_id, account_id)`（同队仅允许存在 1 条“有效申请”；拒绝后是否允许再申请由业务规则决定）
- `INDEX (team_id, status, created_at)`

### 9.4 举报表（MVP 可选但推荐）：`ow_lfg_report`

- `id` BIGINT PK
- `reporter_account_id` BIGINT
- `target_type` VARCHAR(16)（`TEAM`/`ACCOUNT`）
- `target_id` BIGINT
- `reason` VARCHAR(64)
- `detail` VARCHAR(512)
- `snapshot_json` JSON（邀请页快照/关键字段）
- `created_at`

---

## 10. 后端接口设计（建议）

> 参考现有接口风格：统一返回 `ApiResponse<T>`；Account 端接口使用 header `satoken`（见 `web/gm-web-ui/src/api/httpAccount.js`）。

### 10.1 Public（游客可用）

1) 组队大厅列表

- `GET /api/ow/lfg/teams`
- Query：
  - `page`/`size`
  - `keyword`（可选）
  - `modeCode`（可选）
  - `platformCode`（可选）
  - `rankMin`/`rankMax`（可选）
  - `needRole`（可选；如 `TANK/DPS/SUPPORT`）
  - `status`（默认 `OPEN`）
  - `regionCode`/`languageCode`（可选）
  - `voiceRequired`（可选）
- 返回：`PageResult<OwLfgTeamSummaryDto>`

2) 邀请页详情（按 inviteCode）

- `GET /api/ow/lfg/t/{inviteCode}`
- 返回：`OwLfgTeamInviteDto`（含成员列表、状态、剩余时间等）

### 10.2 Account（需要前台登录）

3) 创建队伍

- `POST /api/ow/lfg/teams`
- Body：对应 `ow_lfg_team` 可写字段
- 返回：`OwLfgTeamDetailDto`（含 `inviteCode`）

4) 公开队伍：直接加入

- `POST /api/ow/lfg/teams/{id}/join`
- 规则：
  - 仅 `OPEN` 且未满且未过期
  - 并发控制：建议事务 + `version` 乐观锁/或 `SELECT ... FOR UPDATE`
- 返回：`null` 或 `OwLfgTeamDetailDto`

5) 需审批队伍：申请加入

- `POST /api/ow/lfg/teams/{id}/join-requests`
- Body：`message`（可选）
- 返回：申请详情

6) 撤销申请

- `POST /api/ow/lfg/join-requests/{id}/cancel`

7) 我的队伍

- `GET /api/ow/lfg/my/teams`
- 返回：当前/历史列表（可分页）

8) 退出队伍

- `POST /api/ow/lfg/teams/{id}/leave`

9) 举报

- `POST /api/ow/lfg/reports`

### 10.3 Leader（需要登录 + 队长身份校验）

10) 处理申请：同意/拒绝

- `POST /api/ow/lfg/join-requests/{id}/approve`
- `POST /api/ow/lfg/join-requests/{id}/reject`

11) 踢人

- `POST /api/ow/lfg/teams/{id}/members/{memberId}/kick`

12) 编辑队伍（部分字段）

- `PUT /api/ow/lfg/teams/{id}`

13) 关闭招募 / 解散

- `POST /api/ow/lfg/teams/{id}/close`
- `POST /api/ow/lfg/teams/{id}/disband`

### 10.4 Admin（后置）

- `GET /api/admin/ow/lfg/teams`（列表/筛选）
- `POST /api/admin/ow/lfg/teams/{id}/moderate`（下架/解散/置顶等）

---

## 11. 并发与一致性（无 Redis 条件下的关键点）

- 入队“防超卖”：
  - 方案 A：`ow_lfg_team` 用 `version`，更新时 `where id=? and version=?`；失败重试并提示
  - 方案 B：事务内 `select ... for update` 锁队伍行，校验人数并插入成员
- “已加入/重复申请”：
  - 依赖 `UNIQUE (team_id, account_id)`，捕获唯一键冲突并返回业务提示
- 过期处理：
  - 读接口：若 `now > expires_at` 则视为 `EXPIRED`（可在查询时计算）
  - 写接口：创建/加入/审批时均要校验是否过期

---

## 12. 验收清单（MVP）

- [ ] `/ow/lfg` 可筛选并进入邀请页；空状态引导创建
- [ ] `/ow/lfg/new` 表单校验完善；创建后可复制邀请链接 + 展示二维码
- [ ] `/ow/lfg/t/:inviteCode` 游客可看；登录后可加入/申请；满员/过期/关闭有明确提示
- [ ] 队长可审批申请、踢人、关闭招募、解散
- [ ] “我的队伍”可查看当前/历史，状态准确
- [ ] 基础风控生效（创建频率/同时 OPEN 数限制），并有可追溯日志
- [ ] 可访问性最低要求满足（对比度、键盘可达、错误可读）

---

## 13. 里程碑建议

1) 第 1 周：数据模型 + Public 邀请页/大厅接口 + 前端路由骨架
2) 第 2 周：创建队伍 + 分享组件 + 加入/申请链路
3) 第 3 周：队长管理 + 我的队伍 + 风控/举报落库 + 体验打磨
